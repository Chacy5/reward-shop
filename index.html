<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reward Shop</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat Alternates', sans-serif;
      margin: 0;
      padding: 20px;
      background: #eafff8;
      color: #333;
    }

    h1, h2 {
      color: #065f54;
    }

    .section {
      background: #ffffff;
      padding: 16px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .counter {
      font-size: 1.5rem;
      font-weight: bold;
      text-align: center;
      background: #b2fff0;
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 20px;
    }

    input, button, select {
      font-size: 1rem;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 12px;
      width: 100%;
    }

    button {
      background: #6fedd1;
      color: #fff;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    .card {
      background: #f0fffa;
      border-left: 6px solid #6fedd1;
      border-radius: 10px;
      padding: 12px;
      margin: 10px 0;
    }

    .desc {
      font-size: 0.9rem;
      color: #555;
    }

    .flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    nav a {
      flex: 1;
      text-align: center;
      padding: 10px;
      text-decoration: none;
      color: #065f54;
      font-weight: bold;
    }
  .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #ffffff;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      z-index: 1000;
    }

    body {
      padding-bottom: 70px;
    }

.bottom-nav a.active {
      background: #e0fff8;
      border-top: 3px solid #6fedd1;
    }
.card {
      background: #f0fffa;
      border-left: 6px solid #6fedd1;
      border-radius: 10px;
      padding: 12px;
      margin: 10px 0;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInUp 0.4s ease forwards;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    html {
      scroll-behavior: smooth;
    }
button:active {
      transform: scale(0.97);
      background-color: #57e1c0;
      transition: transform 0.1s, background-color 0.2s;
    }

    .card.fade {
      animation: fadeInUp 0.4s ease forwards;
    }

    .card.daily {
      border-left-color: #6fedd1;
    }

    .card.weekly {
      border-left-color: #fdd36a;
    }

    .card.event {
      border-left-color: #ff9edb;
    }

    .loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      font-size: 1.2rem;
      font-weight: bold;
      color: #065f54;
    }

</style>
</head>
<body>
  <div class="loader" id="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <nav class="bottom-nav">
    <a href="#main" id="nav-main">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a href="#rewardList" id="nav-reward">üè™ –ú–∞–≥–∞–∑–∏–Ω</a>
    <a href="#completed" id="nav-completed">‚úÖ –ó–∞–¥–∞–Ω–∏—è</a>
    <a href="#claimed" id="nav-claimed">üéâ –ù–∞–≥—Ä–∞–¥—ã</a>
</nav>

  <div class="counter">
    –õ–∞–ø–∫–∏: <span id="points">0</span>
  </div>

  <div id="main">
    <div class="section">
      <h2>üìù –ù–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
      <select id="questType">
        <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ</option>
        <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ</option>
        <option value="event">–°–æ–±—ã—Ç–∏–µ</option>
      </select>
      <input type="text" id="taskName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
      <input type="text" id="taskDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
      <input type="number" id="taskPoints" placeholder="–ù–∞–≥—Ä–∞–¥–∞ (–ª–∞–ø–∫–∏)">
      <button onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="section">
      <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
      <div id="questLists"></div>
    </div>

    <div class="section">
      <h2>üéÅ –ù–æ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞</h2>
      <input type="text" id="rewardName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã">
      <input type="text" id="rewardDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
      <input type="number" id="rewardCost" placeholder="–°—Ç–æ–∏–º–æ—Å—Ç—å (–ª–∞–ø–∫–∏)">
      <button onclick="addReward()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="section">
      <h2>üè™ –ú–∞–≥–∞–∑–∏–Ω –Ω–∞–≥—Ä–∞–¥</h2>
      <div id="rewardList"></div>
    </div>
  </div>

  <div class="section" id="completed">
    <h2>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h2>
    <div id="completedList"></div>
  </div>

  <div class="section" id="claimed">
    <h2>üéâ –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã</h2>
    <div id="claimedList"></div>
  </div>

  <script>
    let points = parseInt(localStorage.getItem('pawPoints') || '0');
    let quests = JSON.parse(localStorage.getItem('pawQuests') || '[]');
    let completed = JSON.parse(localStorage.getItem('pawCompleted') || '[]');
    let rewards = JSON.parse(localStorage.getItem('pawRewards') || '[]');
    let claimed = JSON.parse(localStorage.getItem('pawClaimed') || '[]');

    function saveAll() {
      localStorage.setItem('pawPoints', points);
      localStorage.setItem('pawQuests', JSON.stringify(quests));
      localStorage.setItem('pawCompleted', JSON.stringify(completed));
      localStorage.setItem('pawRewards', JSON.stringify(rewards));
      localStorage.setItem('pawClaimed', JSON.stringify(claimed));
    }

    function autoResetTasks() {
  const today = new Date().toDateString();
  if (localStorage.getItem('pawResetDate') === today) return;
  quests = quests.filter(q => q.type !== 'daily' && q.type !== 'weekly');
  localStorage.setItem('pawResetDate', today);
  saveAll();
  renderQuests();
}

function updatePoints() {
      document.getElementById('points').innerText = points;
      saveAll();
    }

    function addTask() {
      const type = document.getElementById('questType').value;
      const name = document.getElementById('taskName').value;
      const desc = document.getElementById('taskDesc').value;
      const pts = parseInt(document.getElementById('taskPoints').value);
      if (!name || isNaN(pts)) return;

      const createdAt = new Date().toISOString();
      quests.push({ type, name, desc, pts, createdAt });
      renderQuests();
    }

    function completeTask(index) {
      const q = quests[index];
      points += q.pts;
      completed.push({ ...q, completedAt: new Date().toISOString() });
      quests.splice(index, 1);
      renderQuests();
      renderCompleted();
      updatePoints();
    }

    function claimReward(index) {
      const r = rewards[index];
      if (points >= r.cost) {
        points -= r.cost;
        claimed.push({ ...r, done: false, claimedAt: new Date().toISOString() });
        updatePoints();
        renderClaimed();
      }
    }

    function markRewardDone(index) {
      claimed[index].done = true;
      renderClaimed();
    }

    function renderQuests() {
      const container = document.getElementById('questLists');
      container.innerHTML = '';
      ['daily','weekly','event'].forEach(type => {
        const title = { daily: '–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ', weekly: '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ', event: '–°–æ–±—ã—Ç–∏—è' }[type];
        const filtered = quests.filter(q => q.type === type);
        if (filtered.length) {
          container.innerHTML += `<h3>${title}</h3>`;
          filtered.forEach((q, i) => {
            container.innerHTML += `
              <div class="card fade ${q.type}">
                <div class="flex">
                  <div><strong>${q.name}</strong><div class="desc">${q.desc}<br><small>üóì ${q.completedAt ? new Date(q.completedAt).toLocaleDateString() : ''}</small></div></div>
                  <button onclick="completeTask(${quests.indexOf(q)})">+${q.pts}</button>
                  <button onclick="editQuest(${quests.indexOf(q)})">‚úèÔ∏è</button>
                  <button onclick="deleteQuest(${quests.indexOf(q)})">üóëÔ∏è</button>
                </div>
              </div>`;
          });
        }
      });
      saveAll();
    }

    function renderCompleted() {
      const list = document.getElementById('completedList');
      list.innerHTML = completed.map(q => `
        <div class="card fade ${q.type}">
          <strong>${q.name}</strong>
          <div class="desc">${q.desc}<br><small>üóì ${q.completedAt ? new Date(q.completedAt).toLocaleDateString() : ''}</small></div>
        </div>`).join('');
      saveAll();
    }

    function renderRewards() {
      const list = document.getElementById('rewardList');
      list.innerHTML = '';
      rewards.forEach((r, i) => {
        list.innerHTML += `
          <div class="card fade ${q.type}">
            <div class="flex">
              <div><strong>${r.name}</strong><div class="desc">${r.desc}<br><small>üõç ${r.claimedAt ? new Date(r.claimedAt).toLocaleDateString() : ''}</small></div></div>
              <div>
                <button onclick="claimReward(${i})" ${points < r.cost ? 'disabled' : ''}>-${r.cost}</button>
                <button onclick="editReward(${i})">‚úèÔ∏è</button>
                <button onclick="deleteReward(${i})">üóëÔ∏è</button>
              </div>
            </div>
          </div>`;
      });
      saveAll();
    }
        <div class="card fade ${q.type}">
          <div class="flex">
            <div><strong>${r.name}</strong><div class="desc">${r.desc}<br><small>üõç ${r.claimedAt ? new Date(r.claimedAt).toLocaleDateString() : ''}</small></div></div>
            <button onclick="claimReward(${i})" ${points < r.cost ? 'disabled' : ''}>-${r.cost}</button>
          </div>
        </div>`).join('');
      saveAll();
    }

    function addReward() {
  const name = document.getElementById('rewardName').value;
  const desc = document.getElementById('rewardDesc').value;
  const cost = parseInt(document.getElementById('rewardCost').value);
  if (!name || !desc || isNaN(cost)) return;

  rewards.push({ name, desc, cost });
  document.getElementById('rewardName').value = '';
  document.getElementById('rewardDesc').value = '';
  document.getElementById('rewardCost').value = '';
  renderRewards();
  saveAll();
}

function renderClaimed() {
      const list = document.getElementById('claimedList');
      list.innerHTML = claimed.map((r, i) => `
        <div class="card fade ${q.type}">
          <div class="flex">
            <div><strong>${r.name}</strong><div class="desc">${r.desc}<br><small>üõç ${r.claimedAt ? new Date(r.claimedAt).toLocaleDateString() : ''}</small></div></div>
            ${r.done ? '‚úÖ' : `<button onclick="markRewardDone(${i})">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>`}
          </div>
        </div>`).join('');
      saveAll();
    }

    updatePoints();
    renderQuests();

    function updateActiveNav() {
      const sections = ['main', 'rewardList', 'completed', 'claimed'];
      let active = 'main';
      for (const id of sections) {
        const el = document.getElementById(id);
        const rect = el.getBoundingClientRect();
        if (rect.top <= 100 && rect.bottom >= 100) {
          active = id;
        }
      }
      document.querySelectorAll('.bottom-nav a').forEach(a => a.classList.remove('active'));
      const nav = document.getElementById('nav-' + active.replace('List', ''));
      if (nav) nav.classList.add('active');
    }

    document.addEventListener('scroll', updateActiveNav);
    window.addEventListener('load', () => {
      autoResetTasks();
      updateActiveNav();
      setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
    });
    window.addEventListener('resize', updateActiveNav);
    renderCompleted();
    renderRewards();
    renderClaimed();

    window.editReward = function(index) {
      const newName = prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:", rewards[index].name);
      const newDesc = prompt("–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:", rewards[index].desc);
      const newCost = prompt("–ù–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:", rewards[index].cost);
      if (newName && newDesc && !isNaN(parseInt(newCost))) {
        rewards[index] = {
          name: newName,
          desc: newDesc,
          cost: parseInt(newCost)
        };
        renderRewards();
        saveAll();
      }
    };

    window.deleteReward = function(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–∞–≥—Ä–∞–¥—É?")) {
        rewards.splice(index, 1);
        renderRewards();
        saveAll();
      }
    };

    window.editQuest = function(index) {
      const newName = prompt("–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:", quests[index].name);
      const newDesc = prompt("–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:", quests[index].desc);
      const newPts = prompt("–ù–æ–≤–∞—è –Ω–∞–≥—Ä–∞–¥–∞:", quests[index].pts);
      if (newName && newDesc && !isNaN(parseInt(newPts))) {
        quests[index].name = newName;
        quests[index].desc = newDesc;
        quests[index].pts = parseInt(newPts);
        renderQuests();
        saveAll();
      }
    };

    window.deleteQuest = function(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ?")) {
        quests.splice(index, 1);
        renderQuests();
        saveAll();
      }
    };

    window.exportData = function() {
      const allData = {
        points, quests, completed, rewards, claimed
      };
      const blob = new Blob([JSON.stringify(allData)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = "reward_shop_backup.json";
      a.click();
    };

    window.importData = function(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = JSON.parse(e.target.result);
        points = data.points || 0;
        quests = data.quests || [];
        completed = data.completed || [];
        rewards = data.rewards || [];
        claimed = data.claimed || [];
        updatePoints();
        renderQuests();
        renderCompleted();
        renderRewards();
        renderClaimed();
      };
      reader.readAsText(file);
    };

    const importInput = document.createElement('input');
    importInput.type = 'file';
    importInput.style.display = 'none';
    importInput.accept = '.json';
    importInput.addEventListener('change', importData);
    document.body.appendChild(importInput);

    const exportBtn = document.createElement('button');
    exportBtn.textContent = 'üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö';
    exportBtn.onclick = exportData;
    exportBtn.style.margin = '10px';
    document.body.appendChild(exportBtn);

    const importBtn = document.createElement('button');
    importBtn.textContent = 'üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö';
    importBtn.onclick = () => importInput.click();
    importBtn.style.margin = '10px';
    document.body.appendChild(importBtn);
  </script>
</body>
</html>
